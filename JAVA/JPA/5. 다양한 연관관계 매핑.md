# 다양한 연관관계 매핑
## 연관관계 매핑 시 고려사항
1. 다중성
2. 단방향, 양방향
3. 연관관계 주인

> 다중성

* 다대일 : @ManyToOne
* 일대다 : @OneToMany
* 일대일 : @OneToOne
* 다대다 : @ManyToMany 

> 단방향, 양방향

* 테이블
    - 외래키 하나로 두 테이블 조인 음가능
    - 방향의 개념이 없음
* 객체
    - 참조용 필드가 있는 쪽으로만 참조 가능
    - 한쪽만 참조하면 단방향
    - 양쪽이 참조하면 양방향
    
> 연관관계의 주인 = 외래키를 관리하는 참

* 테이블은 외래 키 하나로 두 테이블이 연관관계를 맺음
* 객체의 양방향 관계는 참조가 두 군데
* 객체 역시 외래키를 관리할 곳이 필요
* 주인의 반대 편 = 외래 키에 영향 주지 않음, 단순 조회만 가능

## 다대일
### 다대일 단방향
* 가장 많이 사용하는 연관관계
* 반대는 일대다

### 다대일 양방향
* @ManyToOne, @OneToMany 를 각 객체에 넣어준다.
* 주인의 반대편에는 **@OneToMany(mappedBy="주인객체")**

## 일대다
* 권장하지 않는 모델
* 일대다에서 일(1)이 연관관계의 주인
* 다(N)쪽에 외래키가 있는 특이한 구조
* JoinColumn을 쓰지 않으면, 조인 테이블이 생성됨
* 엔티티가 관리하는 외래키가 다른 테이블에 있는 어마어마한 단점

## 일대일
* 주 테이블이나 대상 테이블 중에 외래 키 선택 가능
    - 주 테이블에 외래키
    - 대상 테이블에 외래키
* 외래 키에 데이터베이스 유니크 제약 조건 추가
* 비즈니스 제약 조건(DBA의 입장)과 개발자 입장을 종합적으로 판단하여 결

### 주 테이블에 외래키
![주테이블에 외래키](https://media.vlpt.us/images/ljinsk3/post/f020e35d-4b20-420b-9013-d677956ce257/image.png)
* 대상 테이블 외래키 단방향은 지원하지 않음
* 객체지향 개발자의 입장에서는 셀렉트를 많이 하는 멤버 테이블에 외래키를 놓는 것이 편함
* 장점
    - 주 테이블만 조회해도 대상 테이블에 데이터 있는지 확인 가능
* 단점
    - 값이 없으면 외래키에 null 허용
### 대상 테이블에 외래키
![대상테이블에 외래키](https://media.vlpt.us/post-images/conatuseus/876762f0-0b8f-11ea-ab7d-d93b128a9cd6/image.png)
* "락커를 여러 개 사용 가능하다"라는 비즈니스 제약 조건이 생길 경우, Locker에 외래키를 넣는 것이 유지보수에 편함
* 미리 비즈니스 제약 대응을 고려해야 할 필요 있음.
* 전통적 데이터베이스 개발자들이 선호
* 장점 
    - 주테이블과 대상 테이블을 일대일에서 일대다로 변경할 때 테이블 구조 유지
* 단점
    - 프록시 기능 한계로, 지연 로딩으로 설정해도 항상 즉시 로딩됨
    

